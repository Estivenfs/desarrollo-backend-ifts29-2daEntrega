doctype html
html(lang='es')
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    title= title
    link(rel='stylesheet', href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap')
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css')
    style.
      body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 24px;
        background: linear-gradient(135deg, #f6fbff, #e9f6ff);
        color: #0f4c81;
        display: flex;
        min-height: 100vh;
      }

      .sidebar {
        width: 80px;
        background: linear-gradient(180deg, rgba(6,40,60,0.95), rgba(5,34,54,0.95));
        color: white;
        border-radius: 12px;
        padding: 20px 12px;
        display:flex;
        flex-direction: column;
        align-items: center;
        gap: 18px;
        box-shadow: 0 12px 30px rgba(2,6,23,0.12);
        position: sticky;
        top: 24px;
        height: calc(100vh - 48px);
      }

      .logo {
        width: 44px;
        height: 44px;
        border-radius: 10px;
        background: linear-gradient(135deg,#0b74b6,#0b4fa0);
        display:flex;
        align-items:center;
        justify-content:center;
        font-weight:700;
      }

      .sidebar nav a {
        width: 52px;
        height: 52px;
        border-radius: 10px;
        display:flex;
        align-items:center;
        justify-content:center;
        color: rgba(255,255,255,0.9);
        text-decoration: none;
        font-size: 1.2em;
        transition: transform .18s ease, box-shadow .18s ease;
      }
      .sidebar nav a:hover {
        transform: translateY(-6px);
        box-shadow: 0 10px 26px rgba(4,30,60,0.28);
      }

      .main {
        flex: 1;
        margin-left: 24px;
      }

      .container {
        background: rgba(255,255,255,0.75);
        padding: 28px;
        border-radius: 16px;
        box-shadow: 0 14px 40px rgba(2,6,23,0.08);
      }

      .header-left h1 {
        font-size: 1.9rem;
        margin: 4px 0;
      }

      .top-grid {
        display:grid;
        grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
        gap: 16px;
        margin-top: 22px;
      }

      .metric-card {
        background: linear-gradient(135deg, rgba(239,250,255,0.9), rgba(221,238,255,0.9));
        padding: 18px;
        border-radius: 12px;
        display:flex;
        align-items:center;
        justify-content: space-between;
        border: 1px solid rgba(12,50,80,0.04);
      }

      .metric-left {
        display:flex;
        gap:12px;
        align-items:center;
      }
      .metric-icon {
        width:48px;
        height:48px;
        border-radius:10px;
        display:flex;
        align-items:center;
        justify-content:center;
        background: rgba(11,117,182,0.1);
        color: #0f4c81;
        font-size:1.3em;
      }
      .metric-title { font-size:0.85em; color: #5b7f98; margin:0; }
      .metric-number { font-size:1.6rem; font-weight:700; color: #0f4c81; margin:0; }

      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-top: 28px;
      }

      .info-card {
        background: white;
        padding: 14px;
        border-radius: 12px;
        box-shadow: 0 8px 22px rgba(12,50,80,0.04);
      }

      .info-card h3 {
        margin: 0 0 10px 0;
        font-size: 1rem;
        color: #0f4c81;
        display:flex;
        align-items:center;
        gap:10px;
      }

      ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      li {
        background: linear-gradient(180deg, #ffffff, #fbfdff);
        border-radius: 10px;
        margin-bottom: 10px;
        padding: 10px 12px;
        border: 1px solid rgba(10,60,100,0.03);
      }

  body
    .sidebar
      .logo SI
      nav
        a(href='/' title='Inicio')
          i.fas.fa-house
        a(href='/pacientes' title='Pacientes')
          i.fas.fa-user-injured
        a(href='/medicos' title='Médicos')
          i.fas.fa-user-md
        a(href='/turnos' title='Turnos')
          i.fas.fa-calendar-check

    .main
      .container
        .header-left
          p.clinic-name Clínica Salud Integral
          h1.page-title Dashboard
          p.page-sub Desarrollo Backend - Grupo 4

        .top-grid
          .metric-card
            .metric-left
              .metric-icon
                i.fas.fa-calendar-check
              .metric-data
                p.metric-title Turnos (últ. 7 días)
                p.metric-number= metrics.turnos
          .metric-card
            .metric-left
              .metric-icon
                i.fas.fa-user-injured
              .metric-data
                p.metric-title Pacientes registrados
                p.metric-number= metrics.pacientes
          .metric-card
            .metric-left
              .metric-icon
                i.fas.fa-user-md
              .metric-data
                p.metric-title Médicos activos
                p.metric-number= metrics.medicos

        .info-grid
          .info-card
            h3
              i.fas.fa-list-ul
              | Turnos agendados recientemente
            if turnos.length
              ul
                each t in turnos  
                  li              
                    // FIX 1: Formatear la fecha a dd/mm/aaaa y mostrar la hora
                    strong= `${t.fechaFormateada} ${t.HoraInicio || ''} - ${t.HoraFin || ''}`
                    br
                    // FIX 2: Usar las propiedades correctas que vienen de getTurnosCompletos()
                    span Paciente: #{t.Paciente}
                    br
                    span Médico: #{t.Medico}
            else
              p No hay turnos recientes

          .info-card
            h3
              i.fas.fa-users
              | Pacientes registrados recientemente
            if pacientes.length
              ul
                each p in pacientes
                  li
                    strong= `${p.Nombre || p.nombre} ${p.Apellido || p.apellido}`
                    br
                    span DNI: #{p.DNI || p.dni || '-'} · Obra Social: #{p.ObraSocial || p.obraSocial || '-'}
            else
              p No hay pacientes registrados